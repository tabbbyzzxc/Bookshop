@model NewOrderViewModel

<link rel="stylesheet" href="~/css/order.css" asp-append-version="true" />
<div>
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput" name="searchInput" />
    <button onclick="searchBooks()">Search</button>
</div>

<div class="cart">
    <a type="button" asp-controller="Carts" asp-action="Index"><i class="fa-solid fa-cart-shopping"></i></a>
</div>

<div>
    <h2>Book List</h2>
    <hr />
    <div class="container">
        @for (int i = 0; i < Model.Books.Count / 5; i++)
        {
            <div class="row">
                @for (int j = 0; j < 4; j++)
                {
                    var book = Model.Books[i * 5 + j];
                    <partial name="../Books/_BookProductItem.cshtml" for="@book"></partial>
                }
            </div>

        }
    </div>
</div>


<div>
    <button onclick="openCart()">Open Cart</button>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="successToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="fa-solid fa-circle-exclamation rounded me-2"></i>
            <strong class="me-auto">Success</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Book was successfully added to cart
        </div>
    </div>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="failToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-danger text-white">
            <i class="fa-solid fa-triangle-exclamation rounded me-2"></i>
            <strong class="me-auto">Error</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button><span>5</span>
        </div>
        <div class="toast-body">
            Something went wrong!
        </div>
    </div>
</div>
<script src="https://kit.fontawesome.com/1961c270d9.js" crossorigin="anonymous"></script>
<script>
    function addToCart(bookId) {
        const formData = {
            bookId
        };

        $.ajax({
            type: 'POST',
            url: '/carts/addtocart',
            data: formData,
            success: function (response) {
                if (response.response === true)
                    showToastSuccess(response.message);
                else
                    showToastFail();
            },
            error: function (error) {
                console.error('Error:', error);
                showToastFail();
            }
        });
    }
    
    function showToastSuccess(message) {
        var t = document.getElementById("successToast");
        var toast = new bootstrap.Toast(t);
        t.querySelector(".toast-body").innerHTML = message;
        toast.show();
    }

    function showToastFail(message) {
        var t = document.getElementById("failToast");
        var toast = new bootstrap.Toast(t);
        t.querySelector(".toast-body").innerHTML = message;
        toast.show();
    }

</script>